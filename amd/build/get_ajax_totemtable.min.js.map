{"version":3,"sources":["../src/get_ajax_totemtable.js"],"names":["define","$","ajax","templates","notification","load","blockid","date","offset","limit","skipweekend","promises","call","methodname","args","done","response","render","html","replaceWith","h","height","css","removeClass","scrollItemIndex","scrollTimeInterval","setInterval","row","length","scrollIntoView","clearTimeout","setTimeout","loadingHTML","innerHTML","require","totemtable","fail","exception"],"mappings":"AAQAA,OAAM,mCAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,gBAAxB,CAA0C,mBAA1C,CAAD,CAAiE,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAA6BC,CAA7B,CAA2C,CAC9G,MAAO,CACHC,IAAI,CAAE,cAASC,CAAT,CAAkBC,CAAlB,CAAwBC,CAAxB,CAAgCC,CAAhC,CAAuCC,CAAvC,CAAoD,CACtD,GAAIF,CAAM,EAAIC,CAAd,CAAqB,CACjBD,CAAM,CAAG,CACZ,CAED,GAAIG,CAAAA,CAAQ,CAAGT,CAAI,CAACU,IAAL,CAAU,CACrB,CACIC,UAAU,CAAE,gBADhB,CAEIC,IAAI,CAAE,CACFR,OAAO,CAAEA,CADP,CAEFC,IAAI,CAAEA,CAFJ,CAGFC,MAAM,CAAEA,CAHN,CAIFE,WAAW,CAAEA,CAJX,CAFV,CADqB,CAAV,CAAf,CAWAC,CAAQ,CAAC,CAAD,CAAR,CAAYI,IAAZ,CAAiB,SAASC,CAAT,CAAmB,CAChCb,CAAS,CAACc,MAAV,CAAiB,oCAAjB,CAAuDD,CAAvD,EAAiED,IAAjE,CAAsE,SAASG,CAAT,CAAe,CACjFjB,CAAC,CAAC,oCAAD,CAAD,CAAsCkB,WAAtC,CAAkDD,CAAlD,EAEA,GAAIE,CAAAA,CAAC,CAAGnB,CAAC,CAAC,oCAAD,CAAD,CAAsCoB,MAAtC,EAAR,CACID,CAAC,EAAInB,CAAC,CAAC,0CAAD,CAAD,CAA4CoB,MAA5C,EAAL,CACAD,CAAC,EAAInB,CAAC,CAAC,wCAAD,CAAD,CAA0CoB,MAA1C,EAAL,CACJpB,CAAC,CAAC,2CAAD,CAAD,CAA6CqB,GAA7C,CAAiD,QAAjD,CAA2DF,CAAC,CAAG,IAA/D,EACAnB,CAAC,CAAC,2CAAD,CAAD,CAA6CqB,GAA7C,CAAiD,UAAjD,CAA6D,QAA7D,EACArB,CAAC,CAAC,0CAAD,CAAD,CAA4CsB,WAA5C,CAAwD,QAAxD,EARiF,GAY7EC,CAAAA,CAAe,CAAG,CAZ2D,CAa7EC,CAAkB,CAAGC,WAAW,CAAC,UAAW,CAC5C,GAAIC,CAAAA,CAAG,CAAG1B,CAAC,CAAC,8CAAD,CAAX,CAEA,GAAiB,CAAb,CAAA0B,CAAG,CAACC,MAAR,CAAoB,CAChBD,CAAG,CAACH,CAAD,CAAH,CAAqBK,cAArB,GACAL,CAAe,EAClB,CAED,GAAIG,CAAG,CAACC,MAAJ,EAAcJ,CAAlB,CAAoC,CAChCM,YAAY,CAACL,CAAD,CAAZ,CACAM,UAAU,CAAC,UAAW,CAElB,GAAIC,CAAAA,CAAW,CAAI,kCAAnB,CACIA,CAAW,EAAI,qEAAf,CACJ/B,CAAC,CAAC,oCAAD,CAAD,CAAsCgC,SAAtC,CAAkDD,CAAlD,CAGAE,OAAO,CAAC,CAAC,iCAAD,CAAD,CAAsC,SAASC,CAAT,CAAqB,CAC9DA,CAAU,CAAC9B,IAAX,CAAgBC,CAAhB,CAAyBC,CAAzB,CAA+BC,CAAM,CAAC,CAAtC,CAAyCC,CAAzC,CAAgDC,CAAhD,CACH,CAFM,CAGV,CAVS,MAWb,CACJ,CAtBmC,MAuBvC,CApCD,EAoCG0B,IApCH,CAoCQhC,CAAY,CAACiC,SApCrB,CAqCH,CAtCD,EAsCGD,IAtCH,CAsCQhC,CAAY,CAACiC,SAtCrB,CAuCH,CAxDE,CA0DV,CA3DK,CAAN","sourcesContent":["/**\n * @module    block_totem/slideshow\n * @package   blocktotem\n * @copyright 2020 Aureliano Martini\n * @licence   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since     3.0\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification'], function($, ajax, templates, notification) {\n    return {\n        load: function(blockid, date, offset, limit, skipweekend) {\n            if (offset == limit) {\n                offset = 0;\n            }\n\n            var promises = ajax.call([\n                {\n                    methodname: 'get_totemtable',\n                    args: {\n                        blockid: blockid,\n                        date: date,\n                        offset: offset,\n                        skipweekend: skipweekend\n                    }\n                }\n            ]);\n            promises[0].done(function(response) {\n                templates.render('block_totem/totem_table_fullscreen', response).done(function(html) {\n                    $('[data-region=\"totem_fullscreen\"]').replaceWith(html);\n\n                    var h = $('[data-region=\"totem_fullscreen\"]').height();\n                        h -= $('[data-region=\"totem_fullscreen-title\"]').height();\n                        h -= $('[data-region=\"totem_fullscreen-msg\"]').height();\n                    $('[data-region=\"totem_fullscreen-scroll\"]').css('height', h + 'px');\n                    $('[data-region=\"totem_fullscreen-scroll\"]').css('overflow', 'hidden');\n                    $('[data-region=\"totem_fullscreen-table\"]').removeClass('hidden');\n\n                    //SET SCROLL FUNCTION\n                    var speed = 2000;\n                    var scrollItemIndex = 0;\n                    var scrollTimeInterval = setInterval(function() {\n                        var row = $('[data-region=\"totem_fullscreen-table-row\"]');\n\n                        if (row.length > 0) {\n                            row[scrollItemIndex].scrollIntoView();\n                            scrollItemIndex++;\n                        }\n\n                        if (row.length == scrollItemIndex ) {\n                            clearTimeout(scrollTimeInterval);\n                            setTimeout(function() {\n                                //Show loading screen\n                                var loadingHTML =  '<p style=\"text-align: center\">';\n                                    loadingHTML += '<img src=\"pix/loading.gif\" alt=\"loading...\" width=\"16px\"></p>';\n                                $('[data-region=\"totem_fullscreen\"]').innerHTML = loadingHTML;\n\n                                //AJAX CALL\n                                require([\"block_totem/get_ajax_totemtable\"], function(totemtable) {\n                                    totemtable.load(blockid, date, offset+1, limit, skipweekend);\n                                });\n                            }, speed);\n                        }\n                    }, speed);\n                }).fail(notification.exception);\n            }).fail(notification.exception);\n        }\n    };\n});"],"file":"get_ajax_totemtable.min.js"}